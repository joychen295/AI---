# 辰极脉络 - 服务治理与智能诊断需求说明书

## 一、修订记录

| 修订日期   | 修订内容                         | 修订人员 | 审核人员 |
| :--------- | :------------------------------- | :------- | :------- |
| 2025-12-11 | 辰极脉络服务治理功能初稿         | 待定     | 待定     |

---

## 二、需求背景与目标

### 2.1 编写目的

本文档旨在明确“辰极脉络” (Cortex Registry) 模块的功能需求。作为一个微服务架构的 AI 中台，系统内部包含多个独立服务（如文档解析、向量化、LLM 推理等）。“辰极脉络”旨在提供一个统一的**服务注册中心与治理平台**，实现服务发现、状态监控、依赖分析及故障自愈。

### 2.2 产品背景

随着业务扩展，微服务数量日益增加，手动维护服务列表和排查调用链路故障变得极其困难。系统需要一个可视化的控制台来：

1. **自动发现**：服务实例启动时自动注册，宕机时自动摘除。
2. **依赖可视**：清晰展示服务间的上下游调用关系。
3. **智能诊断**：自动分析服务健康状态，辅助定位系统瓶颈或故障根因。

此模块对应的代码实现主要位于前端 `ServiceRegistryView.vue` 及其引用的子组件。

---

## 三、用户角色与权限

| 角色           | 职责描述                                     | 权限范围                                           |
| :------------- | :------------------------------------------- | :------------------------------------------------- |
| **平台管理员** | 负责微服务架构的运维与稳定性保障。           | **完全权限**。可下线/重启服务实例，修改治理策略。   |
| **开发人员**   | 排查服务调用链路和 Debug。                   | **只读权限**。查看服务列表、日志和依赖图谱。       |

---

## 四、功能架构

辰极脉络界面采用 Tab 标签页式布局，分为以下核心模块：

1. **服务列表 (Service List)**：实例级的管理视图。
2. **统计监控 (Stats Monitor)**：服务整体健康度与流量统计。
3. **配置信息 (Config Info)**：注册中心自身的参数配置。
4. **依赖关系 (Dependency Graph)**：可视化的服务拓扑图。
5. **操作日志 (Operation Log)**：治理操作的审计记录。

---

## 五、功能性需求

### 5.1 服务列表管理

#### 对应组件

`RegistryServiceListPane.vue`

#### 功能描述

展示当前注册中心内所有已注册的服务实例。

* **列表字段**：
  * **服务名称**：如 `ai-rme-core`, `doc-processor`。
  * **实例 ID**：唯一标识符。
  * **地址**：IP:Port。
  * **状态**：Active (健康), Inactive (禁用), Unhealthy (异常)。
  * **最后心跳**：最后一次上报心跳的时间。
* **管理操作**：
  * **单实例操作**：
    * **禁用 (Disable)**：暂时切断该实例的流量，但不注销。
    * **启用 (Enable)**：恢复实例流量。
    * **删除 (Delete)**：将实例从注册表中永久移除（需二次确认）。
      * *安全机制*：若删除处于 Active 状态的实例，弹出红色高危警示框。
  * **批量操作**：支持多选实例，进行批量启用、禁用或删除。

### 5.2 依赖关系拓扑图

#### 对应组件

`DependencyGraphPane.vue`

#### 功能描述

通过图形化方式展示服务间的调用依赖，帮助理解系统架构及故障传导。

* **可视化**：使用力导向图或层级图展示节点（服务）与连线（调用关系）。
* **状态映射**：
  * 节点颜色代表健康度（绿=健康，红=故障，黄=警告）。
  * 连线粗细或流向动画代表流量大小。
* **交互**：点击节点可查看详情，或高亮其上下游相关节点。
* **自动刷新**：支持定期轮询后端接口，动态更新拓扑结构。

### 5.3 统计监控

#### 对应组件

`RegistryStatsPane.vue`

#### 功能描述

展示注册中心的宏观运行指标。

* **核心卡片**：
  * 服务总数 / 实例总数。
  * 健康实例占比。
  * 今日注册/注销频次。
* **趋势图表**：
  * 服务实例数变化趋势（折线图）。
  * 各服务流量占比（饼图）。

### 5.4 智能诊断与日志

#### 对应组件

`OperationLogPane.vue`, `ServiceRegistryView.vue` (逻辑层)

#### 功能描述

* **实时事件**：通过 SSE (Server-Sent Events) 监听注册中心事件（如“新实例上线”、“实例心跳超时”），并即时弹出 Toast 通知管理员。
* **自动诊断**：
  * 前端 `useServiceChanges` 钩子会比对服务列表的变化。
  * 当检测到核心服务（如 RAG Engine）下线时，自动触发警报并记录日志。
* **操作审计**：记录管理员的每一次“禁用”、“删除”操作，包括操作人、时间、对象及结果。

---

## 六、非功能性需求

### 6.1 实时性与一致性

* **自动发现**：页面通过 **长轮询 (Polling)** 或 **SSE** 推送机制，确保服务列表的延迟在 5 秒以内。
* **无感刷新**：轮询更新数据时，不应导致页面闪烁或重置用户的滚动条位置。

### 6.2 容错性

* **批量操作原子性**：批量操作（如批量禁用）应反馈具体的成功/失败数量（如“成功 3 个，失败 1 个”），而不是笼统的报错。
* **数据加载**：依赖图谱加载较慢时，需提供 Loading 状态遮罩。
