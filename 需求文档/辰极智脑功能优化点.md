# 辰极智脑功能优化点

## 档案管理

### 1. 标签体系维护权限优化

#### 涉及模块

文档管理 - 标签管理、文档上传、文档详情

#### 原方案

* **标签管理**：功能入口仅对企业管理员可见。
* **文档上传/详情**：普通用户在上传或编辑文档时，可以进行"标签输入/多选"。这意味着普通用户可以通过输入新标签名来隐式创建新标签。

#### 优化方案（严控型）

* **核心原则**：实行"管理员定义，全员使用"的策略，保证企业标签体系的整洁和规范。
* **具体规则**：
  1. **企业管理员**：拥有完整的标签管理权限（增删改查）。
  2. **普通用户**：在上传或编辑文档时，**仅能从下拉列表中选择**管理员已预设的标签，**禁止输入创建**新标签。
* **优化收益**：防止因普通用户随意创建标签（如大小写差异、同义词堆积）导致的企业标签库混乱，降低后续数据治理成本。

### 2. 上传重名处理逻辑修正

#### 涉及模块

文档管理 - 文档上传

#### 原方案

* **冲突处理**：若用户上传同名文件，系统提示覆盖，选择"是"则自动重命名（如 `文件名(1).pdf`）并作为**新版本**保存。

#### 优化方案

* **核心修正**：将"新版本"修正为"新文件"。
* **具体描述**：若用户上传同名文件，系统提示"文件名已存在，是否覆盖？"。
  * 选择"是"：系统自动重命名（如 `文件名(1).pdf`），并将其作为一条**全新的文档记录**（拥有独立的 File ID）进行保存和处理。
  * 选择"否"：取消上传。
* **优化收益**：消除歧义，明确系统不涉及复杂的"多版本控制（Version Control）"逻辑，降低开发理解偏差，简化后端数据模型设计。

### 3. 标签管理入口权限控制

#### 涉及模块

文档管理 - 标签管理按钮

#### 现状说明

* **文档描述**：需求文档中明确"标签管理功能入口仅对企业管理员角色可见"。
* **代码实现**：当前 `DocumentHeader.vue` 中的"标签管理"按钮对所有用户都显示，没有角色判断逻辑。

#### 优化方案

* **前端控制**：根据 `authStore.user.role` 判断当前用户角色，仅当角色为"企业管理员"或更高权限时，才渲染"标签管理"按钮。
* **后端保护**：标签的增删改接口需校验请求用户的权限，拒绝普通用户的操作请求。

#### 优化收益

* 与需求文档保持一致，确保标签体系由管理员统一维护。

---

## 认证模块

### 1. 忘记密码入口

#### 涉及模块

用户登录页

#### 现状说明

* 当前登录页面仅提供"登录"按钮和"切换主题"按钮，没有"忘记密码"入口。
* 由于本系统依赖 ts_manage 进行用户管理，用户忘记密码时需联系企业管理员在 ts_manage 后台重置。

#### 优化方案

* **新增入口**：在登录页密码输入框下方或登录按钮区域，增加"忘记密码？"的文字链接。
* **交互设计**：
  1. 用户点击"忘记密码？"链接。
  2. 系统弹出提示框（`ElMessageBox`），内容为："请联系贵公司的企业管理员在中央管理系统（ts_manage）中重置密码。"
  3. 提示框包含"知道了"按钮，点击后关闭弹框。
* **优化收益**：为用户提供清晰的密码找回指引，降低因忘记密码导致的用户困惑和客服咨询量。

---

## 知识库查询

### 1. VikingDB 知识库检索体验优化

#### 涉及模块

知识库查询 - 智能查询界面 (Smart Query Interface)

#### 现状说明

* **现象**：当配置启用 "VikingDB 知识库" 作为 RAG Provider 时，系统正确进入智能查询界面。但在发起查询时，返回内容包含大量非结构化的"思考流"或"长文本流"（用户反馈为"一大串思考流式"），缺乏清晰的结构化展示。
* **问题**：这与"智能查询"所强调的精准问答（Answer）和来源引用（Source）体验不符，干扰了用户获取关键信息。

#### 优化方案

* **结果结构化**：在后端或前端层面对 VikingDB 的返回结果进行清洗和结构化处理，区分"推理/思考过程"与"最终答案"。
* **UI展示优化**：
  * **思考折叠**：如果必须保留思考过程，建议将其折叠在类似"思考过程"的可展开区域中，默认仅展示最终结论。
  * **样式对齐**：确保 VikingDB 模式下的结果展示与 LightRAG 模式保持一致的排版风格（Markdown渲染、引用标注等）。
* **后端Prompt调整**：检查后端集成逻辑，优化 Prompt 以控制输出格式，减少不必要的中间思维过程暴露。

#### 优化收益

* 提升 VikingDB 模式下的查询可读性，确保"智能查询"模块在不同 Provider 下提供一致的高质量用户体验。
