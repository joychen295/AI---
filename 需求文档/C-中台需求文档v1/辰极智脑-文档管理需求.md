# 辰极智脑 文档管理需求

## 一、修订记录

| 修订日期 | 修订内容                 | 修订人员 |
| -------- | ------------------------ | -------- |
| 12.03    | 辰极智脑增加文档管理功能 | 陈文静   |

---

## 二、需求背景与目标

### 2.1 编写目的

本文档旨在明确"辰极智脑"系统中"文档管理"模块的功能需求、交互逻辑及非功能性指标。该文档将作为UI设计、前端开发、后端开发及测试用例编写的依据。

### 2.2 产品背景

在企业知识管理和AI应用场景下，非结构化数据（文档）是核心资产。需要一个统一的文档管理平台来支撑知识库的构建与维护。文档管理功能作为辰极智脑的基础能力,为后续的 RAG（检索增强生成）、AI 问答、知识检索等功能提供底层数据支撑。

### 2.3 术语定义

* **RAG (Retrieval-Augmented Generation)**: 检索增强生成,一种结合了检索和生成能力的 AI 技术。
* **OSS (Object Storage Service)**: 对象存储服务,用于存储海量非结构化数据。
* **向量化 (Embedding)**: 将文本转换为向量数据的过程,用于计算机理解语义。

## 三、业务流程

```
用户上传文档 → 文档存储至云端 → 触发知识库构建 → 文档智能分析处理 → 向量化存储 → 可用于智能检索
    ↓
状态流转：上传中 → 已上传 → 处理中 → 已处理（或失败）
```

**知识库构建流程**：

1. 用户上传文档后,文档状态为"已上传"
2. 系统自动触发知识库构建任务,状态变更为"处理中"
3. 后台异步执行文档智能分析、分块、向量化处理
4. 处理完成后,状态变更为"已处理"；失败则变更为"失败"
5. 系统自动轮询任务状态,直到所有任务完成

---

## 四、功能性需求

### 4.1 文档列表

#### 原型图

（请插入原型图）

#### 业务说明

本页面是文档管理的核心功能页面,负责展示当前租户下的所有文档,并提供文档的查询、筛选、查看、下载、删除等操作。

**模块间交互规则**：

1. **文件上传后的影响**：
   - 文件上传成功后,自动刷新文档列表,新上传的文件显示在列表顶部（按上传时间倒序）
   - 统计卡片中的"总文档数"、"今日上传"、"总存储量"数据自动更新
   - 如果上传时配置了分类和标签,文件会带上这些属性显示在列表中

2. **文件删除后的影响**：
   - 文件删除成功后,从列表中移除该文件
   - 统计卡片中的"总文档数"、"总存储量"数据自动更新
   - 如果删除的文件正在被知识库使用,根据删除类型决定是否同步删除知识库数据

3. **文件处理状态变化的影响**：
   - 文件上传后自动触发知识库构建,状态从"已上传"变为"处理中"
   - 系统以3秒为间隔轮询任务状态,实时更新列表中文件的状态
   - 统计卡片中的"处理中"数量实时更新
   - 处理完成后,文件状态变为"已处理",知识库可用于AI问答和检索

4. **标签管理的影响**：
   - 在标签管理中创建的新标签,会立即在列表页的标签筛选下拉框中显示
   - 在标签管理中编辑标签名称,列表中使用该标签的文件会自动更新标签名称
   - 在标签管理中删除标签,列表中使用该标签的文件会自动移除该标签

5. **批量操作的影响**：
   - 批量删除成功后,所有被删除的文件从列表中移除,统计卡片数据更新
   - 批量分类成功后,所有选中文件的分类更新为目标分类
   - 批量标签成功后,根据操作类型（添加/移除/替换）,所有选中文件的标签相应更新
   - 批量下载不影响文件列表和其他数据

6. **详情编辑的影响**：
   - 在文档详情侧边栏中编辑文件信息（显示名称、分类、标签、描述）并保存后,列表中对应文件的信息自动更新

**页面数据加载规则**：

1. 页面初次加载时,获取统计卡片数据和文档列表数据（默认第1页,每页20条）
2. 文档列表按上传时间倒序排列（最新上传的在最上面）
3. 如果存在"处理中"或"上传中"状态的文件,启动3秒间隔的状态轮询
4. 无活动任务时自动停止轮询,节省资源

**权限要求**：

- 需要用户登录认证
- 所有操作需要通过认证密钥验证

#### 界面字段说明

| 字段名称       | 字段类型 | 字段长度 | 是否必填 | 展示及校验规则                                                                     |
| -------------- | -------- | -------- | -------- | ---------------------------------------------------------------------------------- |
| 搜索关键词     | 字符串   | /        | 否       | 按文件名模糊搜索,不区分大小写；输入防抖300毫秒                                    |
| 分类筛选       | 枚举值   | /        | 否       | 下拉单选；可选项：技术文档/设计文档/需求文档/测试文档/用户手册；支持清空选择       |
| 状态筛选       | 枚举值   | /        | 否       | 下拉单选；可选项：上传中/已上传/处理中/已处理/失败；支持清空选择                   |
| 文件类型筛选   | 枚举值   | /        | 否       | 下拉单选；可选项：PDF文档/Word文档/Excel表格/PowerPoint/图片/文本文档；支持清空选择 |
| 日期范围       | 日期范围 | /        | 否       | 日期范围选择器；格式：YYYY-MM-DD；按创建时间筛选,包含起止日期；支持清空选择       |
| 标签筛选       | 数组     | /        | 否       | 下拉多选；选项来源：系统中所有已使用的标签；展示包含任一选中标签的文档；支持清空   |
| 文件大小范围   | 数字范围 | /        | 否       | 两个数字输入框（最小/最大）；单位：MB；精度：2位小数；最大值不能小于最小值         |

#### 界面操作说明

| 操作名称       | 操作说明                                                                                                                                                                                                                                                                                                                               |
| -------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 搜索文档       | 在搜索框输入关键词,实时按文件名模糊搜索；不区分大小写；输入防抖300毫秒；支持清空按钮                                                                                                                                                                                                                                                  |
| 筛选文档       | 下拉选择分类/状态/文件类型,列表仅展示符合条件的文档；支持清空选择恢复全部显示；支持多条件组合筛选                                                                                                                                                                                                                                      |
| 日期范围筛选   | 点击日期范围选择器,选择起始日期和结束日期；格式：YYYY-MM-DD；列表仅展示该时间范围内上传的文档（包含起止日期）；支持清空选择                                                                                                                                                                                                            |
| 高级筛选展开   | 点击"展开高级筛选"按钮,展开高级筛选区（标签筛选、文件大小范围）；按钮文案变为"收起高级筛选",图标变为ArrowUp；再次点击收起高级筛选区                                                                                                                                                                                                    |
| 标签筛选       | 在高级筛选区,下拉多选标签；选项来源：系统中所有已使用的标签；列表仅展示包含任一选中标签的文档；支持清空所有选中                                                                                                                                                                                                                        |
| 文件大小筛选   | 在高级筛选区,输入最小大小和最大大小；单位：MB；精度：2位小数；列表仅展示该范围内的文档（包含边界值）；校验规则：最大值不能小于最小值,否则提示错误                                                                                                                                                                                       |
| 重置筛选       | 点击"重置"按钮,清空所有筛选条件（搜索词、分类、状态、文件类型、日期范围、标签、文件大小）；列表恢复初始状态,展示所有文档,按上传时间倒序排列                                                                                                                                                                                            |
| 全选文件       | 勾选表头全选复选框,选中当前页所有文件；背景色高亮显示选中状态；再次勾选取消全选；切换页码时保持已选中文件的状态（支持跨页多选）                                                                                                                                                                                                        |
| 单选文件       | 勾选行复选框,选中/取消选中单个文件；选中后背景色高亮显示                                                                                                                                                                                                                                                                               |
| 查看文档详情   | 点击文件名或操作列的【查看】按钮（图标：View,提示："查看详情"）；右侧滑出文档详情侧边栏；宽度50%;从右到左展开；背景遮罩半透明黑色                                                                                                                                                                                                    |
| 下载文件       | 点击操作列的【下载】按钮（图标：Download,提示："下载文件"）；系统获取文件预签名下载链接（有效期1小时）；触发浏览器下载；成功提示："开始下载"                                                                                                                                                                                          |
| 删除文件       | 点击操作列的【删除】按钮（图标：Delete,样式：danger红色,提示："删除文件"）；弹出确认框：<br>- 标题："确认删除"<br>- 内容："确定要删除文件 [文件名] 吗？此操作不可撤销。"<br>- 确认按钮："确定删除"（红色）<br>- 取消按钮："取消"<br>点击确认后执行删除；成功后文件从列表中移除,统计卡片数据更新；失败提示失败原因                    |
| 批量删除       | 选中至少一个文件后,点击【批量删除】按钮（文案："批量删除",图标：Delete,类型：红色）；打开批量操作对话框,默认选中删除操作；后续操作见4.4批量操作                                                                                                                                                                                        |
| 批量操作       | 选中至少一个文件后,点击【批量操作】下拉按钮（文案："批量操作",图标：More）；下拉菜单显示：批量分类、批量标签、批量下载；点击任一选项打开批量操作对话框,默认选中对应操作；后续操作见4.4批量操作                                                                                                                                          |
| 上传文档       | 点击页面右上角【上传文档】按钮；打开文档上传对话框；后续操作见4.2文档上传                                                                                                                                                                                                                                                              |
| 标签管理       | 点击页面右上角【标签管理】按钮（图标：PriceTag）；打开标签管理对话框；后续操作见4.5标签管理                                                                                                                                                                                                                                           |
| 分页切换       | 点击页码、上一页、下一页按钮切换页面；或在跳转输入框输入页码按回车快速跳转；列表展示对应页的文档                                                                                                                                                                                                                                      |
| 改变每页条数   | 下拉选择每页条数（可选：10/20/50/100,默认：20）；列表重新加载,展示对应条数的文档；页码重置为第1页                                                                                                                                                                                                                                     |
| 查看完整文件名 | 鼠标悬停在截断的文件名上；Tooltip显示完整文件名                                                                                                                                                                                                                                                                                        |
| 查看统计数据   | 页面顶部展示四个统计卡片：<br>- 总文档数：当前租户所有文档数量<br>- 处理中：状态为"处理中"的文档数量<br>- 总存储量：所有文档占用的存储空间（格式化为KB/MB/GB）<br>- 今日上传：今日（当天零点至当前时刻）上传的文档数量<br>数据实时更新：页面初次加载、文件上传成功、文件删除成功、任务状态变化时                                      |

---

### 4.2 文档上传

#### 原型图

（请插入原型图）

#### 业务说明

本功能负责文档文件的上传,支持拖拽上传和点击上传两种方式,可批量上传多个文件,并支持为上传的文件配置分类、标签和描述信息。

**模块间交互规则**：

1. **文件上传成功后的影响**：
   - 自动关闭上传对话框（延迟1.5秒）
   - 自动刷新文档列表页面,新上传的文件显示在列表顶部
   - 自动更新统计卡片数据（总文档数、今日上传、总存储量）
   - 如果上传时配置了分类和标签,文件会带上这些属性
   - 系统自动触发知识库构建任务,文件状态从"已上传"变为"处理中"

2. **文件上传失败的影响**：
   - 对话框保持打开状态
   - 显示失败文件列表和失败原因
   - 成功上传的文件正常刷新到列表,失败的文件不显示

3. **上传配置的应用**：
   - 在上传配置面板中选择的分类、标签、描述会应用到所有上传的文件
   - 上传成功后,文件列表中可以看到这些配置信息
   - 后续可在文档详情中修改这些配置

**文件校验规则**：

1. 文件大小校验：单文件最大100MB,超限文件不加入上传列表,提示："文件 [文件名] 大小超过 100MB,请压缩后重试"
2. 文件格式校验：仅支持特定格式（见非功能性需求5.2）,不支持的格式不加入上传列表,提示："不支持 [扩展名] 格式,请上传支持的格式"
3. 文件名长度校验：最大255字节,超限提示："文件名过长,请修改文件名后重试"

**上传流程说明**：

1. 文件添加到待上传列表后,状态为"待上传"
2. 点击"开始上传"按钮后,按钮变为禁用状态,文案变为"上传中...",显示loading动画
3. 系统串行上传文件（逐个上传,避免并发导致的性能问题）
4. 每个文件上传时,状态变为"上传中",显示进度条和百分比
5. 上传成功后,状态变为"上传成功",进度条变为绿色100%
6. 上传失败后,状态变为"上传失败",显示失败原因
7. 所有文件上传完成后,统计结果并提示,延迟1.5秒后自动关闭对话框

#### 界面字段说明

| 字段名称 | 字段类型 | 字段长度  | 是否必填 | 展示及校验规则                                                                                                                      |
| -------- | -------- | --------- | -------- | ----------------------------------------------------------------------------------------------------------------------------------- |
| 文件列表 | 文件数组 | 100MB/个  | 是       | 支持多文件；单文件最大100MB；支持的格式：pdf/txt/md/doc/docx/ppt/pptx/xls/xlsx/html/csv/json/xml/png/jpg/jpeg/gif/bmp/tif/tiff/webp |
| 分类     | 枚举值   | /         | 否       | 可选项：技术文档/设计文档/需求文档/测试文档/用户手册；应用到所有上传的文件                                                          |
| 标签     | 数组     | 20字符/个 | 否       | 多选；支持创建新标签；每个标签长度不超过20字符；应用到所有上传的文件                                                                |
| 描述     | 字符串   | 500字符   | 否       | 可选；文本域；最大500字符；应用到所有上传的文件                                                                                     |

#### 界面操作说明

| 操作名称       | 操作说明                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| -------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 打开上传对话框 | 点击文档列表页面右上角【上传文档】按钮；弹出上传对话框：<br>- 标题："上传文档"<br>- 宽度：60%（最小宽度800px,响应式）<br>- 背景遮罩：半透明黑色,点击遮罩不关闭对话框                                                                                                                                                                                                                                                                                                                                            |
| 拖拽上传文件   | 将文件拖拽到上传区域（高度：150px,边框：2px虚线灰色,上传图标：48px主题色）；拖拽悬停时边框变为主题色,背景色变为主题色10%透明度,提示："松开鼠标上传文件"；松开鼠标后自动校验文件（大小、格式、文件名长度）；校验通过后添加到待上传列表；支持同时拖拽多个文件                                                                                                                                                                                                                                                    |
| 点击上传文件   | 点击上传区域任意位置；打开系统文件选择对话框；支持多选文件（multiple属性）；选择文件后自动校验；校验通过后添加到待上传列表                                                                                                                                                                                                                                                                                                                                                                                        |
| 移除待上传文件 | 点击待上传文件列表中的【移除】按钮（图标：Close,颜色：红色）；文件从待上传列表中移除；仅"待上传"状态的文件显示移除按钮                                                                                                                                                                                                                                                                                                                                                                                            |
| 查看待上传列表 | 位置：上传区域下方；列表为空时不展示；列表不为空时显示：<br>- 列表标题："待上传文件（X个）"<br>- 列表最大高度：300px,超出滚动<br>- 每个文件项展示：文件图标（根据类型,大小24px）、文件名（完整展示,过长换行）、文件大小（格式化为KB/MB）、上传状态（待上传/上传中/上传成功/上传失败）、进度条（上传中时显示,线性进度条,高度20px,显示百分比,蓝色0-99%/绿色100%）、移除按钮（待上传状态显示）                                                                                                       |
| 展开上传配置   | 点击"上传配置"面板标题栏（默认收起）；面板展开,图标变为ArrowDown；展示配置项：分类、标签、描述；再次点击收起面板,图标变为ArrowUp                                                                                                                                                                                                                                                                                                                                                                                  |
| 选择分类       | 在上传配置面板中,下拉选择文档分类（标签："分类",标签宽度：80px）；占位符："选择文档分类（可选）"；可选项：技术文档/设计文档/需求文档/测试文档/用户手册；支持清空选择；所选分类将应用到所有上传的文件                                                                                                                                                                                                                                                                                                            |
| 添加标签       | 在上传配置面板中,下拉多选标签（标签："标签",标签宽度：80px）；占位符："选择或创建标签（可选）"；选项来源：系统预设标签（重要、紧急、待审核、已审核、草稿、已发布）+ 用户创建的标签；支持创建新标签：输入标签名后回车创建,新标签自动添加到选项列表；标签名称长度限制：20字符,超长提示："标签名称不能超过20字符"；所选标签将应用到所有上传的文件                                                                                                                                                  |
| 输入描述       | 在上传配置面板中,文本域输入文档描述（标签："描述",标签宽度：80px）；占位符："输入文档描述（可选）"；行数：3行；最大长度：500字符；显示字数统计；所输入的描述将应用到所有上传的文件                                                                                                                                                                                                                                                                                                                                |
| 开始上传       | 点击【开始上传】按钮（位置：对话框底部右侧,类型：primary主题色）；禁用条件：待上传列表为空时禁用；点击后按钮文案变为"上传中...",禁用按钮,显示loading动画；系统串行上传文件：遍历待上传列表,逐个文件上传,当前文件完成后开始下一个；每个文件上传流程：设置状态为"上传中"→调用上传接口→监听进度→实时更新进度条→成功设置为"上传成功"进度条100%绿色→失败设置为"上传失败"进度条红色,记录失败原因                                                                                                 |
| 查看上传结果   | 所有文件上传完成后,统计结果并展示提示：<br>- 全部成功："成功上传 X 个文件"<br>- 部分成功："成功上传 X 个文件,Y 个文件上传失败"<br>- 全部失败："所有文件上传失败,请检查网络后重试"<br>延迟1.5秒后自动关闭对话框；关闭后自动刷新文档列表和统计卡片                                                                                                                                                                                                                                                                 |
| 取消上传       | 点击【取消】按钮（位置：对话框底部右侧,"开始上传"按钮左侧,类型：default）；如果有正在上传的文件,弹出二次确认框：<br>- 标题："确认关闭"<br>- 内容："正在上传中,确定要关闭吗？未完成的上传将被取消。"<br>- 确认按钮："确定关闭"<br>- 取消按钮："继续上传"<br>确认后取消所有正在上传的请求,清空待上传列表,关闭对话框；如果没有正在上传的文件,直接关闭对话框                                                                                                                                                  |
| 关闭对话框     | 点击对话框关闭按钮或按ESC键；如果有正在上传的文件,触发上传中断处理流程（同"取消上传"）；如果没有正在上传的文件,直接关闭对话框                                                                                                                                                                                                                                                                                                                                                                                     |

---

### 4.3 文档详情

#### 原型图

（请插入原型图）

#### 业务说明

本功能以侧边栏抽屉形式展示文档的详细信息,包括基本信息、时间信息、存储信息等,支持编辑文档的显示名称、分类、标签和描述。

**模块间交互规则**：

1. **详情编辑保存后的影响**：
   - 保存成功后,自动刷新文档列表中该文件的信息（显示名称、分类、标签、描述）
   - 侧边栏宽度从60%恢复为50%
   - 可编辑字段恢复为只读状态
   - 按钮从"保存"恢复为"编辑"

2. **详情编辑中创建新标签的影响**：
   - 编辑详情时创建的新标签,保存后会立即在标签管理中显示
   - 后续在其他文件的详情编辑或批量标签操作中可以选择该标签

3. **详情下载的影响**：
   - 下载操作不影响文件列表和其他数据
   - 生成预签名下载链接（有效期1小时）

4. **复制功能的影响**：
   - 复制文件ID、对象键、MD5、SHA256等字段到剪贴板
   - 不影响任何数据

**详情数据展示规则**：

1. 基本信息卡片（始终展开）：展示文件ID、显示名称、文件大小、文件类型、状态、分类、标签、描述
2. 时间信息卡片（始终展开）：展示创建时间、上传时间（如已上传）、处理完成时间（如已处理）
3. 存储信息卡片（默认折叠）：展示OSS存储桶、对象键、MD5校验和、SHA256校验和、上传进度（如上传中）、处理状态

**编辑模式说明**：

1. 查看模式：侧边栏宽度50%,所有字段只读显示,按钮为"编辑"
2. 编辑模式：侧边栏宽度60%,可编辑字段变为输入状态,按钮为"保存"
3. 切换动画：宽度变化平滑过渡
4. 未保存更改时关闭侧边栏：弹出确认框提示

#### 界面字段说明

| 字段名称 | 字段类型 | 字段长度  | 是否必填 | 展示及校验规则                                                 |
| -------- | -------- | --------- | -------- | -------------------------------------------------------------- |
| 显示名称 | 字符串   | 255字符   | 是       | 文本输入框；不能为空；不超过255字符；实时校验                  |
| 分类     | 字符串   | 50字符    | 否       | 下拉单选；可选项：技术文档/设计文档/需求文档/测试文档/用户手册 |
| 标签     | 数组     | 20字符/个 | 否       | 下拉多选；支持创建新标签；每个标签长度不超过20字符             |
| 描述     | 字符串   | 500字符   | 否       | 文本域；最大500字符；显示字数统计                              |

#### 界面操作说明

| 操作名称           | 操作说明                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| ------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 打开文档详情       | 在文档列表中点击文件名或操作列的【查看】按钮；从页面右侧滑出详情侧边栏：<br>- 组件类型：抽屉<br>- 标题："文档详情"<br>- 展开方向：从右到左<br>- 宽度：50%（最小宽度600px）<br>- 背景遮罩：半透明黑色                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| 查看基本信息       | 基本信息卡片展示（标题："基本信息",带阴影,圆角4px）：<br>- 文件ID：完整唯一标识符,等宽字体12px灰色,可复制<br>- 显示名称：纯文本14px（查看模式）或文本输入框（编辑模式）<br>- 文件大小：格式化显示（KB/MB/GB）,深灰色,只读<br>- 文件类型：MIME类型,标签形式,只读<br>- 状态：标签形式,颜色动态变化（上传中蓝/已上传绿/处理中黄/已处理绿/失败红）,只读<br>- 分类：标签形式或"未分类"灰色（查看模式）或下拉单选（编辑模式）<br>- 标签：多个标签或"无标签"灰色（查看模式）或下拉多选（编辑模式）<br>- 描述：纯文本或"无描述"灰色（查看模式）或文本域（编辑模式）                                                                                               |
| 查看时间信息       | 时间信息卡片展示（标题："时间信息"）：<br>- 创建时间：格式YYYY/M/D HH:mm:ss,深灰色,只读<br>- 上传时间：格式同上,未上传时不显示,只读<br>- 处理完成时间：格式同上,未处理完成时不显示,只读                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| 查看存储信息       | 存储信息卡片（标题："存储信息",可折叠,默认折叠）；点击标题栏展开/收起；展开后显示：<br>- OSS存储桶：完整名称,等宽字体12px灰色,只读<br>- 对象键：完整OSS对象键,等宽字体12px灰色,可复制,只读<br>- MD5校验和：32位16进制字符串,等宽字体12px灰色,可复制,只读<br>- SHA256校验和：显示前16字符+"...",悬停Tooltip显示完整值,等宽字体12px灰色,可复制完整值,只读<br>- 上传进度：仅上传中时显示,进度条形式,显示百分比,蓝色（上传中）/绿色（已完成）<br>- 处理状态：标签形式,待处理灰/处理中蓝/已完成绿/失败红,只读                                                                                                                                                             |
| 切换编辑模式       | 查看模式下,点击侧边栏头部右侧的【编辑】按钮（文案："编辑",图标：Edit）；切换到编辑模式：<br>- 侧边栏宽度从50%平滑过渡到60%<br>- 可编辑字段（显示名称、分类、标签、描述）变为输入状态<br>- 按钮文案和图标变为"保存"和Check图标                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| 编辑显示名称       | 编辑模式下,在显示名称文本输入框修改名称；最大长度：255字符,显示字数统计；实时校验：为空时显示错误"显示名称不能为空",超长时提示"显示名称不能超过255字符"；保存时生效                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 编辑分类           | 编辑模式下,下拉选择分类；占位符："选择分类"；可选项：技术文档/设计文档/需求文档/测试文档/用户手册；可清空；保存时生效                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| 编辑标签           | 编辑模式下,下拉多选标签；占位符："选择或创建标签"；选项来源：系统预设标签+用户创建的标签；支持创建新标签：输入标签名后回车创建,标签名称长度限制20字符,超长提示"标签名称不能超过20字符",重复提示"标签名称已存在"；可清空；保存时生效                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 编辑描述           | 编辑模式下,在描述文本域输入描述；占位符："输入文档描述"；行数：3行；最大长度：500字符,显示字数统计；超长时禁止输入；保存时生效                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| 保存编辑           | 编辑模式下,点击【保存】按钮（文案："保存",图标：Check）；实时校验所有必填字段：显示名称不能为空；校验通过后提交更新请求；更新成功：提示"保存成功",侧边栏宽度恢复为50%,可编辑字段恢复为只读状态,按钮恢复为"编辑",刷新文档列表中该文件的信息；更新失败：提示失败原因,保持编辑模式                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| 复制字段内容       | 点击可复制字段（文件ID、对象键、MD5校验和、SHA256校验和）右侧的复制按钮（图标：CopyDocument）；复制完整值到剪贴板；提示"复制成功"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 下载文件           | 点击侧边栏头部右侧的【下载】按钮（文案："下载",图标：Download,位置：编辑按钮左侧）；系统获取文件预签名下载链接（有效期1小时）；触发浏览器下载；成功提示："开始下载"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| 关闭详情侧边栏     | 点击遮罩区域、点击右上角关闭按钮（图标：Close,类型：text）或按ESC键；如果在编辑模式且有未保存的更改,弹出确认框：<br>- 标题："未保存的更改"<br>- 类型：warning<br>- 内容："您有未保存的更改,确定要关闭吗？"<br>- 确认按钮："放弃更改"<br>- 取消按钮："继续编辑"<br>点击确认后关闭侧边栏；如果不在编辑模式或无未保存更改,直接关闭侧边栏                                                                                                                                                                                                                                                                                                                                                                                           |
| 查看完整字段值     | 鼠标悬停在截断显示的字段（如SHA256校验和）上；Tooltip显示完整值                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 折叠/展开存储信息  | 点击存储信息卡片标题栏；切换卡片内容的折叠/展开状态                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |

---

### 4.4 批量操作

#### 原型图

（请插入原型图）

#### 业务说明

本功能支持对选中的多个文件进行批量删除、批量分类、批量标签、批量下载操作,提高批量处理文件的效率。

**模块间交互规则**：

1. **批量删除成功后的影响**：
   - 所有被删除的文件从文档列表中移除
   - 统计卡片数据自动更新（总文档数、总存储量）
   - 清空选中状态
   - 如果采用强一致删除,知识库中的文档数据也会被删除

2. **批量分类成功后的影响**：
   - 文档列表中所有选中文件的分类更新为目标分类
   - 清空选中状态
   - 后续可在文档详情中查看到更新后的分类

3. **批量标签成功后的影响**：
   - 根据操作类型（添加/移除/替换）,文档列表中所有选中文件的标签相应更新：
     - 添加标签：新标签添加到文件现有标签中（不覆盖原有标签）
     - 移除标签：从文件现有标签中移除指定标签（保留其他标签）
     - 替换标签：用新标签完全替换文件现有的所有标签（清空原有标签）
   - 清空选中状态
   - 后续可在文档详情中查看到更新后的标签

4. **批量下载操作的影响**：
   - 系统将所有选中文件打包为压缩包（ZIP或TAR格式）
   - 根据命名规则重命名文件（保持原名/添加时间戳/顺序编号）
   - 触发浏览器下载
   - 不影响文件列表和其他数据

5. **批量操作中创建新标签的影响**：
   - 批量标签操作中创建的新标签,保存后会立即在标签管理中显示
   - 后续在其他文件的详情编辑或批量标签操作中可以选择该标签

**批量操作限制**：

1. 单次批量操作最多支持100个文件
2. 超过限制时,顶部展示错误提示,禁用【确认】按钮
3. 批量删除需要勾选确认复选框才能执行

**批量操作结果处理**：

1. 全部成功：提示成功信息,关闭对话框,刷新列表,清空选中
2. 部分成功：展示失败文件明细（表格：文件名、失败原因）,提供【重试】按钮,刷新列表
3. 全部失败：展示错误信息,提供【重试】按钮

#### 界面字段说明

| 字段名称     | 字段类型 | 字段长度  | 是否必填 | 展示及校验规则                                                     |
| ------------ | -------- | --------- | -------- | ------------------------------------------------------------------ |
| 操作类型     | 枚举值   | /         | 是       | 单选按钮组；可选项：删除/分类/标签/下载                            |
| 目标分类     | 枚举值   | /         | 条件必填 | 批量分类时必选；可选项：技术文档/设计文档/需求文档/测试文档/用户手册 |
| 标签操作类型 | 枚举值   | /         | 条件必填 | 批量标签时必选；可选项：添加标签/移除标签/替换标签                 |
| 目标标签     | 数组     | 20字符/个 | 条件必填 | 批量标签时必选；多选；支持创建新标签                               |
| 压缩格式     | 枚举值   | /         | 否       | 批量下载时选择；可选项：ZIP压缩包/TAR归档；默认：ZIP压缩包         |
| 命名规则     | 枚举值   | /         | 否       | 批量下载时选择；可选项：保持原名/添加时间戳/顺序编号；默认：保持原名 |
| 删除确认     | 布尔值   | /         | 条件必填 | 批量删除时必须勾选确认复选框                                       |

#### 界面操作说明

| 操作名称         | 操作说明                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| ---------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 打开批量操作对话框 | 在文档列表中选中至少一个文件（勾选复选框）；页面右上角出现批量操作按钮组：<br>- 已选中文件数量提示："已选中 X 个文件"（位置：表格左上角）<br>- 【批量删除】按钮：文案"批量删除",图标Delete,红色,启用条件：至少选中一个文件<br>- 【批量操作】下拉按钮：文案"批量操作",图标More,类型default,下拉菜单：批量分类、批量标签、批量下载<br>点击任一按钮,打开批量操作对话框：<br>- 标题："批量操作"<br>- 宽度：600px（最小宽度500px,响应式）<br>- 背景遮罩：半透明黑色,点击遮罩不关闭对话框<br>- 顶部显示选中文件数量；如果超过100个,展示红色错误提示："单次批量操作最多支持100个文件,当前已选中 X 个",禁用【确认】按钮                                                                                                                                                                                                                                                                  |
| 选择操作类型     | 在对话框中,单选按钮组选择操作类型（块状按钮,图标+文字）：<br>- 批量删除：图标Delete,颜色红色<br>- 批量分类：图标Folder,颜色蓝色<br>- 批量标签：图标PriceTag,颜色绿色<br>- 批量下载：图标Download,颜色紫色<br>必选,默认值根据点击的按钮确定；选择后展示对应的配置区                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| 批量删除         | 选择【批量删除】后,展示危险操作警告区：<br>- 警告图标：红色感叹号48px<br>- 警告标题："危险操作",红色18px加粗<br>- 警告内容："此操作将永久删除所选文件,且无法恢复。请确认后再执行。",深灰色<br>- 文件预览区：标题"待删除文件：",列表带边框最大高度200px滚动；文件数≤5展示所有,>5展示前5个+"还有 X 个文件..."；每个文件项：文件图标、文件名、文件大小<br>- 确认复选框：文案"我确认要删除这些文件,且明白此操作不可撤销",红色文字大字号,必须勾选才能启用【确认】按钮,默认不勾选<br>点击【确认】按钮：前置校验（确认复选框未勾选提示"请勾选确认复选框"；文件数>100提示"单次批量操作最多支持100个文件"）；按钮文案变为"删除中...",禁用,显示loading；提交删除请求；处理结果见"查看批量操作结果"                                                                                                                                                                                                                  |
| 批量分类         | 选择【批量分类】后,展示分类配置区：<br>- 标签："目标分类"<br>- 组件类型：下拉单选<br>- 占位符："选择分类"<br>- 选项列表：技术文档、设计文档、需求文档、测试文档、用户手册<br>- 必选：未选择时显示错误"请选择目标分类"<br>- 说明文本："所选分类将应用到所有选中的文件",灰色<br>点击【确认】按钮：前置校验（未选择分类提示"请选择目标分类"；文件数>100提示"单次批量操作最多支持100个文件"）；提交批量分类请求；成功后提示"成功为 X 个文件设置分类",关闭对话框,刷新文档列表,清空选中状态                                                                                                                                                                                                                                                                                                                                                                                                                    |
| 批量标签         | 选择【批量标签】后,展示标签操作配置区：<br>**标签操作选择**：<br>- 标签："标签操作"<br>- 组件类型：下拉单选<br>- 占位符："选择操作类型"<br>- 选项：添加标签（说明："将选定的标签添加到文件现有标签中（不覆盖原有标签）"）、移除标签（说明："从文件现有标签中移除选定的标签（保留其他标签）"）、替换标签（说明："用选定的标签完全替换文件现有的所有标签（清空原有标签）"）<br>- 必选：未选择时显示错误"请选择操作类型"<br>**目标标签选择**：<br>- 标签："目标标签"<br>- 组件类型：下拉多选<br>- 占位符："选择标签"<br>- 选项来源：系统中所有标签（预设标签+用户创建的标签）<br>- 支持创建新标签：输入标签名后回车创建,标签名称长度限制20字符,超长提示"标签名称不能超过20字符"<br>- 必选：未选择时显示错误"请选择目标标签"<br>点击【确认】按钮：前置校验（未选择操作类型提示"请选择操作类型"；未选择目标标签提示"请选择目标标签"；文件数>100提示"单次批量操作最多支持100个文件"）；提交批量标签请求；成功后根据操作类型提示（添加："成功为 X 个文件添加标签"；移除："成功为 X 个文件移除标签"；替换："成功为 X 个文件替换标签"）,关闭对话框,刷新文档列表,清空选中状态 |
| 批量下载         | 选择【批量下载】后,展示下载配置区：<br>**压缩格式选择**：<br>- 标签："压缩格式"<br>- 组件类型：单选按钮组,块状样式<br>- 选项：ZIP压缩包（图标：Folder-zip,说明："适用于Windows系统,兼容性好"）、TAR归档（图标：Folder,说明："适用于Linux/Unix系统,保留文件权限"）<br>- 默认选中：ZIP压缩包<br>**文件命名规则选择**：<br>- 标签："文件命名规则"<br>- 组件类型：下拉单选<br>- 占位符："选择命名规则"<br>- 选项：保持原名（说明："文件名保持不变",示例："file1.pdf, file2.docx"）、添加时间戳（说明："文件名后添加时间戳（格式：YYYYMMDDHHmmss）",示例："file1_20250120143000.pdf, file2_20250120143001.docx"）、顺序编号（说明："文件名前添加顺序编号（格式：001_、002_...）",示例："001_file1.pdf, 002_file2.docx"）<br>- 默认选中：保持原名<br>点击【确认】按钮：前置校验（文件数>100提示"单次批量操作最多支持100个文件"）；提交批量下载请求；系统打包压缩（压缩包命名：documents_YYYYMMDDHHmmss.zip）；返回下载链接；触发浏览器下载；成功提示"开始下载 X 个文件",关闭对话框                                                          |
| 取消批量操作     | 点击【取消】按钮（位置：对话框底部右侧,"确认"按钮左侧,类型：次要按钮）；关闭对话框；不执行任何操作；保持选中状态                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 查看批量操作结果 | **全部成功**：提示"成功XXX X个文件"（根据操作类型）；关闭对话框；刷新文档列表；刷新统计卡片；清空选中状态<br>**部分成功**：提示"成功XXX X个文件,Y个文件XXX失败"；对话框展示失败文件明细表格（列：文件名、失败原因）,失败文件红色高亮；显示【重试】按钮（仅针对失败文件重新执行）和【关闭】按钮；刷新文档列表（移除成功处理的文件）；刷新统计卡片<br>**全部失败**：提示"所有文件XXX失败"；对话框展示详细错误信息；显示【重试】按钮（重新执行）和【关闭】按钮                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| 重试失败操作     | 批量操作部分失败后,点击【重试】按钮；仅对失败文件列表重新执行操作；等待完成；查看结果提示                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |

---

### 4.5 标签管理

#### 原型图

（请插入原型图）

#### 业务说明

本功能负责统一管理系统中的所有标签,包括预设标签和用户自定义标签,支持创建、编辑、删除标签。

**模块间交互规则**：

1. **创建标签后的影响**：
   - 新创建的标签立即添加到标签列表（自定义标签区域的最前面）
   - 新标签立即在以下位置可选：
     - 文档列表页的标签筛选下拉框
     - 文档上传对话框的标签选择下拉框
     - 文档详情编辑的标签选择下拉框
     - 批量标签操作的目标标签下拉框

2. **编辑标签后的影响**：
   - 标签列表中该标签名称更新
   - 文档列表中所有使用该标签的文件自动更新标签名称显示
   - 所有标签选择下拉框中该标签名称同步更新
   - 不影响文件与标签的关联关系

3. **删除标签后的影响**：
   - 标签从标签列表中移除
   - 文档列表中所有使用该标签的文件自动移除该标签
   - 所有标签选择下拉框中该标签被移除
   - 如果文档列表正在展示,自动刷新列表显示

4. **预设标签说明**：
   - 系统预设6个标签：重要、紧急、待审核、已审核、草稿、已发布
   - 预设标签不可删除,但可以编辑名称
   - 预设标签始终在列表最前面
   - 预设标签不显示使用次数

5. **自定义标签说明**：
   - 用户创建的标签可编辑、可删除
   - 按创建时间倒序排列（最新创建的在最前面）
   - 显示使用次数："在 X 个文件中使用"或"未使用"

#### 界面字段说明

| 字段名称 | 字段类型 | 字段长度 | 是否必填 | 展示及校验规则                                 |
| -------- | -------- | -------- | -------- | ---------------------------------------------- |
| 标签名称 | 字符串   | 20字符   | 是       | 不能为空；不能重复；长度不超过20字符；实时校验 |

#### 界面操作说明

| 操作名称           | 操作说明                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| ------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 打开标签管理对话框 | 点击文档列表页面右上角【标签管理】按钮（图标：PriceTag）；弹出标签管理对话框：<br>- 标题："标签管理"<br>- 宽度：500px（最小宽度400px,响应式）<br>- 高度：最大600px,超出内容区域滚动<br>- 背景遮罩：半透明黑色<br>- 关闭方式：点击遮罩、点击右上角关闭按钮、按ESC键                                                                                                                                                                                                                                                                                   |
| 搜索标签           | 在顶部操作区搜索框输入关键词（占位符："搜索标签...",左侧图标：Search,宽度：250px）；实时按标签名称模糊搜索（不区分大小写）；输入防抖：300毫秒；支持清空按钮；无匹配结果时展示"未找到匹配的标签"                                                                                                                                                                                                                                                                                                                                                      |
| 查看标签列表       | 列表以表格形式展示（最大高度：400px,超出滚动）：<br>**表格列**：<br>- 标签名称列：列标题"标签名称",宽度200px；内容：标签名称文本；预设标签展示灰色"预设"标识<br>- 使用次数列：列标题"使用次数",宽度100px,居中；预设标签不显示使用次数；自定义标签显示"在 X 个文件中使用"或"未使用"（灰色）<br>- 操作列：列标题"操作",宽度150px,固定右侧,居中；所有标签显示【编辑】按钮（图标：Edit,类型：文本按钮,提示："编辑标签"）；仅自定义标签显示【删除】按钮（图标：Delete,类型：文本按钮红色,提示："删除标签"）<br>**排序规则**：预设标签在最前面,自定义标签按创建时间倒序 |
| 新建标签           | 点击顶部操作区【新建标签】按钮（文案："新建标签",图标：Plus,类型：主要按钮,位置：搜索框右侧）；弹出新建标签输入对话框：<br>- 标题："新建标签"<br>- 宽度：400px<br>- 标签名称输入框：标签"标签名称"标签宽度80px,占位符"输入标签名称",最大长度20字符,显示字数统计,自动聚焦；实时校验：为空时显示错误"标签名称不能为空",重复时显示错误"标签名称已存在",超长时禁止输入<br>- 底部按钮：【取消】（类型：次要按钮,点击关闭对话框）和【创建】（类型：主要按钮,禁用条件：标签名称为空或重复,点击创建）<br>点击【创建】：校验标签名称；提交创建请求；成功提示"标签创建成功",新标签添加到列表,关闭输入对话框,刷新标签列表；失败提示失败原因,保持输入对话框打开                      |
| 编辑标签           | 点击标签的【编辑】按钮；弹出编辑标签输入对话框：<br>- 标题："编辑标签"<br>- 宽度：400px<br>- 标签名称输入框：标签"标签名称"标签宽度80px,默认值为当前标签名称,最大长度20字符,显示字数统计,自动聚焦并全选文本；实时校验：为空时显示错误"标签名称不能为空",与其他标签重复时显示错误"标签名称已存在",超长时禁止输入<br>- 底部按钮：【取消】（类型：次要按钮,点击关闭对话框）和【保存】（类型：主要按钮,禁用条件：标签名称为空、重复或未修改,点击保存）<br>点击【保存】：校验标签名称；提交更新请求；成功提示"标签更新成功",列表中标签名称更新,关闭输入对话框,刷新标签列表,刷新所有使用该标签的文档（自动更新）；失败提示失败原因,保持输入对话框打开                                             |
| 删除标签           | 点击标签的【删除】按钮；弹出确认框：<br>- 标题："确认删除"<br>- 类型：警告<br>- 内容：主要文案"确定要删除标签 [标签名称] 吗？"（标签名称黄色加粗）；如果标签在使用中,警告文案"此标签在 X 个文件中使用,删除后将从这些文件中移除"（使用次数黄色加粗）；如果标签未使用,警告文案"此操作不可撤销"<br>- 底部按钮：【取消】（类型：次要按钮,点击关闭确认框）和【确定删除】（类型：危险按钮红色,点击删除）<br>点击【确定删除】：提交删除请求；系统自动从所有使用该标签的文件中移除该标签；成功提示"标签删除成功",从列表中移除该标签,刷新标签列表,刷新文档列表（如正在展示）；失败提示失败原因,标签保留在列表中                                                                 |
| 关闭标签管理对话框 | 点击右上角【关闭】按钮（图标：Close）、点击遮罩或按ESC键；关闭标签管理对话框                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |

---

## 五、非功能性需求

### 5.1 文件限制

| 限制项             | 限制值           | 说明                                       |
| ------------------ | ---------------- | ------------------------------------------ |
| 单文件大小限制     | 100 MB           | 前后端双重校验；超限文件拒绝上传           |
| 单次请求最大文件数 | 10 个            | 单次上传请求最多支持10个文件；超限提示错误 |
| 单次批量操作最多   | 100 个文件       | 包括批量删除、批量分类、批量标签、批量下载 |
| 文件名长度限制     | 255 字节         | 超限时提示"文件名过长,请修改文件名后重试" |
| 标签名称长度限制   | 20 字符          | 创建和编辑标签时校验                       |
| 描述长度限制       | 500 字符         | 文档描述字段的最大长度                     |
| 上传超时时间       | 300 秒           | 单个文件上传的最大时长；超时提示错误       |
| 下载链接有效期     | 3600 秒（1小时） | 下载链接的有效时长                         |
| 并发上传控制       | 系统自动控制     | 系统限制同时上传的文件数,防止服务器过载   |
| 任务状态轮询间隔   | 3 秒             | 知识库构建任务的状态轮询频率               |
| 分页默认条数       | 20 条            | 文档列表默认每页展示20条                   |
| 分页最大条数       | 100 条           | 文档列表最多每页展示100条                  |

### 5.2 支持的文件格式

| 类型   | 格式                                                                     | 校验方式   | 说明         |
| ------ | ------------------------------------------------------------------------ | ---------- | ------------ |
| 文档类 | pdf、txt、md、doc、docx、ppt、pptx、xls、xlsx、html、htm、csv、json、xml | 文件扩展名 | 不区分大小写 |
| 图片类 | png、jpg、jpeg、gif、bmp、tif、tiff、webp                                | 文件扩展名 | 不区分大小写 |

**不支持的格式处理**：

* 前端上传时校验文件扩展名
* 不支持的文件不加入上传列表
* 提示："不支持 [扩展名] 格式,请上传支持的格式"

### 5.3 知识库构建配置

| 配置项       | 默认值        | 说明                                     |
| ------------ | ------------- | ---------------------------------------- |
| 分块策略     | 基于Token分块 | 可选：基于Token分块 / 基于段落分块       |
| 分块大小     | 1200 tokens   | 单个文档块的token数量                    |
| 分块重叠大小 | 100 tokens    | 相邻文档块之间的重叠token数量            |
| 批处理大小   | 5 个文件      | 单次批量处理的文件数量                   |
| 后台异步执行 | 是            | 知识库构建在后台异步执行,不阻塞用户操作 |
| 强制重建     | 否            | 默认不强制重建已存在的知识库             |
| 分割字符     | 无            | 可选；段落分块策略下的自定义分割字符     |

### 5.4 文件处理状态流转

| 状态   | 说明                     | 下一状态              | 展示颜色 |
| ------ | ------------------------ | --------------------- | -------- |
| 上传中 | 正在上传                 | 已上传 或 失败        | 蓝色     |
| 已上传 | 上传完成,待处理         | 处理中                | 绿色     |
| 处理中 | 正在处理（知识库构建中） | 已处理 或 失败        | 黄色     |
| 已处理 | 处理完成                 | -                     | 绿色     |
| 失败   | 处理失败                 | 可重新处理回到 处理中 | 红色     |
| 已删除 | 已删除                   | -                     | 灰色     |

**状态流转触发时机**：

* 上传中 → 已上传：文件上传完成时
* 已上传 → 处理中：知识库构建任务开始时
* 处理中 → 已处理：知识库构建成功时
* 处理中 → 失败：知识库构建失败时
* 任意状态 → 已删除：文件删除时

### 5.5 文件删除规则

| 删除类型   | 删除范围                                                               | 适用场景                     |
| ---------- | ---------------------------------------------------------------------- | ---------------------------- |
| 标准删除   | 删除文件存储 + 删除文件记录；不删除知识库数据                          | 默认删除方式,保留知识库数据 |
| 强一致删除 | 1. 读取文件元数据；2. 删除知识库文档；3. 删除文件存储；4. 删除文件记录 | 需要同步删除知识库数据时     |

**删除流程说明**：

* **标准删除流程**：

  1. 删除文件存储
  2. 删除文件记录
  3. 知识库数据保留（可能导致知识库数据孤儿）
* **强一致删除流程**：

  1. 读取文件元数据
  2. 解析知识库文档ID
  3. 删除知识库文档
  4. 删除成功后,删除文件存储
  5. 删除文件记录
  6. 如果知识库删除失败,中止整个删除操作,保留文件

**删除失败处理**：

* 知识库删除失败：中止操作,返回错误"知识库删除异常,操作已中止",不删除文件存储和文件记录
* 文件存储删除失败：记录错误日志,继续删除文件记录（可能导致存储数据孤儿）
* 文件记录删除失败：记录错误日志,返回错误"文件删除失败"
* 批量删除时：逐个处理每个文件,独立处理成功或失败,返回成功和失败统计

### 5.6 错误提示

| 错误场景         | 提示内容                                       | 处理方式                     |
| ---------------- | ---------------------------------------------- | ---------------------------- |
| 文件不存在       | 文件不存在或已被删除,请刷新页面               | 提示用户并刷新列表           |
| 文件过大         | 文件大小超过限制（最大100MB）,请压缩后重试    | 拒绝上传,提示限制信息       |
| 不支持的文件类型 | 不支持 [扩展名] 格式,请上传支持的格式         | 拒绝上传,提示支持的格式列表 |
| 批量操作超限     | 单次批量操作最多支持100个文件,当前已选中 X 个 | 禁用确认按钮,提示当前选中数 |
| 上传超时         | 文件上传超时,请检查网络后重试                 | 提示用户重新上传             |
| 存储服务异常     | 存储服务异常,请稍后重试或联系管理员           | 提示用户重试或联系管理员     |
| 知识库删除失败   | 知识库删除异常,操作已中止                     | 中止删除操作,保留文件       |
| 速率限制         | 请求过于频繁,请稍后重试                       | 提示用户等待后重试           |
| 文件名过长       | 文件名过长,请修改文件名后重试                 | 拒绝上传,提示修改文件名     |
| 标签名称重复     | 标签名称已存在,请使用其他名称                 | 提示用户修改标签名称         |
| 标签名称过长     | 标签名称不能超过20字符                         | 提示用户缩短标签名称         |
| 必填字段为空     | [字段名]不能为空                               | 提示用户填写必填字段         |
| 删除失败         | 文件删除失败,请稍后重试                       | 提示用户重试                 |
| 未登录           | 请先登录                                       | 跳转到登录页面               |
| 无权限           | 您没有权限执行此操作                           | 提示用户并禁用操作按钮       |
| 网络错误         | 网络连接失败,请检查网络后重试                 | 提示用户检查网络             |

### 5.7 性能优化

| 优化项       | 实现方式                                                                | 效果                             |
| ------------ | ----------------------------------------------------------------------- | -------------------------------- |
| 分页加载     | 列表分页,默认每页20条；最大支持100条/页                                | 减少单次加载数据量,提升渲染速度 |
| 任务轮询     | 仅在有活动任务时启动轮询；无活动任务时自动停止；轮询间隔3秒             | 减少不必要的请求,节省资源       |
| 批量操作     | 支持最多100个文件批量操作；系统逐个处理,避免一次性处理过多文件导致超时 | 防止服务器过载,提升稳定性       |
| 缓存         | 查询历史存储在本地；减少重复请求                                        | 加快页面加载速度,减少网络请求   |
| 进度反馈     | 实时显示上传进度、处理进度；用户可见性高                                | 提升用户体验,减少等待焦虑       |
| 串行上传     | 逐个文件串行上传；避免同时处理多个大文件导致浏览器内存溢出              | 提升浏览器性能,防止崩溃         |
| 后台异步处理 | 知识库构建在后台异步执行；不阻塞用户操作                                | 提升用户体验,允许并行操作       |
| 预签名下载   | 下载文件使用预签名链接；减轻服务器压力；有效期1小时                     | 提升下载速度,减轻服务器负载     |
| 防抖处理     | 搜索框输入、筛选条件变化使用300毫秒防抖                                 | 减少不必要的请求                 |
| 懒加载       | 大列表使用虚拟滚动（可选）；图片懒加载                                  | 提升初始加载速度                 |
| 响应式设计   | 对话框、侧边栏宽度响应式；适配不同屏幕尺寸                              | 提升移动端和小屏幕设备体验       |

### 5.8 安全性

| 安全项       | 实现方式                                     | 说明                       |
| ------------ | -------------------------------------------- | -------------------------- |
| 文件校验     | 生成文件校验和；保证文件完整性               | 包括MD5和SHA256校验        |
| 文件格式校验 | 前后端双重校验文件格式；拒绝不支持的格式     | 防止恶意文件上传           |
| 文件大小校验 | 前后端双重校验文件大小；拒绝超限文件         | 防止资源耗尽攻击           |
| 权限校验     | 所有操作需要用户认证                         | 保证只有登录用户可操作     |
| 防止重复上传 | 通过文件校验和判断是否为重复文件（可选功能） | 节省存储空间,防止重复数据 |
| 下载链接安全 | 下载链接有效期1小时；过期自动失效            | 防止链接泄露导致的安全问题 |
| 认证密钥     | 所有请求需要携带认证密钥；系统验证           | 防止未授权访问             |
| 速率限制     | 限制请求频率；防止恶意刷接口                 | 防止拒绝服务攻击           |
| 二次确认     | 删除等危险操作需要用户二次确认；防止误操作   | 提升数据安全性             |
| 加密传输     | 所有请求使用HTTPS加密传输                    | 防止数据被窃听             |
| 跨站脚本防护 | 用户输入内容进行转义；防止跨站脚本攻击       | 保护用户数据安全           |
| 跨站请求防护 | 使用安全令牌；防止跨站请求伪造攻击           | 保护用户操作安全           |

---

## 六、补充说明

### 6.1 文件存储架构

* **存储方式**：阿里云OSS对象存储
* **存储规则**：根据文件元数据生成唯一存储路径
* **访问方式**：
  * 上传：直接上传至云端存储
  * 下载：通过预签名链接访问（有效期1小时）
  * 删除：先删除知识库（如需）,再删除文件存储,最后删除文件记录
* **访问控制**：
  * 私有访问
  * 仅通过预签名链接或直接下载接口访问

### 6.2 知识库集成

* **自动构建触发时机**：文件上传成功后自动触发知识库构建
* **构建配置**：
  * 分块策略：基于Token分块
  * 分块大小：1200 tokens
  * 分块重叠：100 tokens
  * 批处理大小：5个文件/批次
* **批量处理机制**：每次处理5个文件,避免一次性处理过多文件导致超时或内存溢出
* **状态同步**：系统自动更新文件处理状态
* **查询支持**：构建完成后,文档内容可用于AI问答和知识检索
* **错误处理**：
  * 构建失败时,文件状态变为"失败"
  * 记录失败原因,用户可查看详情
  * 支持重新触发构建（手动或自动重试）

### 6.3 任务管理

* **任务类型**：知识库构建任务
* **任务状态**：
  * 待处理：任务已创建,等待执行
  * 执行中：任务正在执行
  * 已完成：任务执行成功
  * 失败：任务执行失败
* **状态轮询**：
  * 轮询间隔：3秒
  * 轮询条件：存在活动任务（待处理或执行中）
  * 停止条件：无活动任务时自动停止轮询
* **任务监控**：
  * 用户可在界面上实时查看任务进度
  * 任务完成后自动刷新文档列表和统计卡片
  * 任务失败后展示失败原因
* **任务队列**：
  * 系统使用任务队列管理任务执行
  * 支持并发执行多个任务（受批处理大小限制）
  * 任务优先级：先进先出

---

**备注**：

1. 原型图需要补充,建议使用Figma或Axure制作高保真原型
2. 文档中的所有文案、提示内容、错误信息均为实际使用的文案
3. 所有配置项、限制值、时间参数均来自实际配置
4. 如有业务调整需求,需同步更新本需求文档
5. 本文档版本：v1.0,最后更新时间：2025-12-03
